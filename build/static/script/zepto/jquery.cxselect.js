/**
 * @author 
 * @email 
 * @descrip zhong'ou wechat.
 * @version v1.0.0
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery||window.Zepto||window.$)}(function($){var t=function(){for(var e,a,n,s=0,i=arguments.length;s<i;s++)t.isJquery(arguments[s])||t.isZepto(arguments[s])?e=arguments[s]:t.isElement(arguments[s])?e=$(arguments[s]):"function"==typeof arguments[s]?n=arguments[s]:"object"==typeof arguments[s]&&(a=arguments[s]);var r=new t.init(e,a);return"function"==typeof n&&n(r),r};t.isElement=function(t){return!(!t||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(t instanceof HTMLElement))||!(!t||!t.nodeType||1!==t.nodeType)},t.isJquery=function(t){return!!(t&&t.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&t instanceof jQuery)},t.isZepto=function(t){return!(!t||!t.length||"function"!=typeof Zepto&&"object"!=typeof Zepto||!Zepto.zepto.isZ(t))},t.getIndex=function(t,e){return e?t:t-1},t.getData=function(t,e){if("string"==typeof e&&e.length){e=e.split(".");for(var a=0,n=e.length;a<n;a++)t=t[e[a]]}return t},t.init=function(e,a){var n=this;if(t.isJquery(e)||t.isZepto(e)){var s={dom:{box:e}};n.attach=t.attach.bind(s),n.detach=t.detach.bind(s),n.setOptions=t.setOptions.bind(s),n.clear=t.clear.bind(s),s.changeEvent=function(){t.selectChange.call(s,this.className)},s.settings=$.extend({},$.cxSelect.defaults,a,{url:s.dom.box.data("url"),emptyStyle:s.dom.box.data("emptyStyle"),required:s.dom.box.data("required"),firstTitle:s.dom.box.data("firstTitle"),firstValue:s.dom.box.data("firstValue"),jsonSpace:s.dom.box.data("jsonSpace"),jsonName:s.dom.box.data("jsonName"),jsonValue:s.dom.box.data("jsonValue"),jsonSub:s.dom.box.data("jsonSub")});var i=s.dom.box.data("selects");"string"==typeof i&&i.length&&(s.settings.selects=i.split(",")),n.setOptions(),n.attach(),s.settings.url||s.settings.data?$.isArray(s.settings.data)?t.start.call(s,s.settings.data):"string"==typeof s.settings.url&&s.settings.url.length&&$.getJSON(s.settings.url,function(e){t.start.call(s,e)}):t.start.apply(s)}},t.setOptions=function(e){var a=this;if(e&&$.extend(a.settings,e),(!$.isArray(a.selectArray)||!a.selectArray.length||e&&e.selects)&&(a.selectArray=[],$.isArray(a.settings.selects)&&a.settings.selects.length))for(var n,s=0,i=a.settings.selects.length;s<i&&(n=a.dom.box.find("select."+a.settings.selects[s]),n&&n.length);s++)a.selectArray.push(n);e&&(!$.isArray(e.data)&&"string"==typeof e.url&&e.url.length?$.getJSON(a.settings.url,function(e){t.start.call(a,e)}):t.start.call(a,e.data))},t.attach=function(){var e=this;e.attachStatus||e.dom.box.on("change","select",e.changeEvent),"boolean"==typeof e.attachStatus&&t.start.call(e),e.attachStatus=!0},t.detach=function(){var t=this;t.dom.box.off("change","select",t.changeEvent),t.attachStatus=!1},t.clear=function(t){var e=this,a={display:"",visibility:""};t=isNaN(t)?0:t;for(var n=t,s=e.selectArray.length;n<s;n++)e.selectArray[n].empty().prop("disabled",!0),"none"===e.settings.emptyStyle?a.display="none":"hidden"===e.settings.emptyStyle&&(a.visibility="hidden"),e.selectArray[n].css(a)},t.start=function(e){var a=this;if($.isArray(e)&&(a.settings.data=t.getData(e,a.settings.jsonSpace)),a.selectArray.length){for(var n=0,s=a.selectArray.length;n<s;n++)"string"!=typeof a.selectArray[n].attr("data-value")&&a.selectArray[n][0].options.length&&a.selectArray[n].attr("data-value",a.selectArray[n].val());a.settings.data||"string"==typeof a.selectArray[0].data("url")&&a.selectArray[0].data("url").length?t.getOptionData.call(a,0):a.selectArray[0].prop("disabled",!1).css({display:"",visibility:""})}},t.getOptionData=function(e){var a=this;if(!("number"!=typeof e||isNaN(e)||e<0||e>=a.selectArray.length)){var n,s,i,r,l,o=a.selectArray[e],c=o.data("url"),d="undefined"==typeof o.data("jsonSpace")?a.settings.jsonSpace:o.data("jsonSpace"),f={};if(t.clear.call(a,e),"string"==typeof c&&c.length){if(e>0)for(var u=0,g=1;u<e;u++,g++)i=a.selectArray[g].data("queryName"),r=a.selectArray[u].attr("name"),l=a.selectArray[u].val(),"string"==typeof i&&i.length?f[i]=l:"string"==typeof r&&r.length&&(f[r]=l);$.getJSON(c,f,function(s){n=t.getData(s,d),t.buildOption.call(a,e,n)})}else if(a.settings.data&&"object"==typeof a.settings.data){n=a.settings.data;for(var u=0;u<e;u++){if(s=t.getIndex(a.selectArray[u][0].selectedIndex,"boolean"==typeof a.selectArray[u].data("required")?a.selectArray[u].data("required"):a.settings.required),"object"!=typeof n[s]||!$.isArray(n[s][a.settings.jsonSub])||!n[s][a.settings.jsonSub].length){n=null;break}n=n[s][a.settings.jsonSub]}t.buildOption.call(a,e,n)}}},t.buildOption=function(t,e){var a=this,n=a.selectArray[t],s="boolean"==typeof n.data("required")?n.data("required"):a.settings.required,i="undefined"==typeof n.data("firstTitle")?a.settings.firstTitle:n.data("firstTitle"),r="undefined"==typeof n.data("firstValue")?a.settings.firstValue:n.data("firstValue"),l="undefined"==typeof n.data("jsonName")?a.settings.jsonName:n.data("jsonName"),o="undefined"==typeof n.data("jsonValue")?a.settings.jsonValue:n.data("jsonValue");if($.isArray(e)){var c=s?"":'<option value="'+String(r)+'">'+String(i)+"</option>";if("string"==typeof l&&l.length){"string"==typeof o&&o.length||(o=l);for(var d=0,f=e.length;d<f;d++)c+='<option value="'+String(e[d][o])+'">'+String(e[d][l])+"</option>"}else for(var d=0,f=e.length;d<f;d++)c+='<option value="'+String(e[d])+'">'+String(e[d])+"</option>";n.html(c).prop("disabled",!1).css({display:"",visibility:""}),"string"==typeof n.attr("data-value")&&(n.val(String(n.attr("data-value"))).removeAttr("data-value"),n[0].selectedIndex<0&&(n[0].options[0].selected=!0)),(s||n[0].selectedIndex>0)&&n.trigger("change")}},t.selectChange=function(e){var a=this;if("string"==typeof e&&e.length){var n;e=e.replace(/\s+/g,","),e=","+e+",";for(var s=0,i=a.selectArray.length;s<i;s++)if(e.indexOf(","+a.settings.selects[s]+",")>-1){n=s;break}"number"==typeof n&&n>-1&&(n+=1,t.getOptionData.call(a,n))}},$.cxSelect=function(){return t.apply(this,arguments)},$.cxSelect.defaults={selects:[],url:null,data:null,emptyStyle:null,required:!1,firstTitle:"请选择",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"},$.fn.cxSelect=function(t,e){return this.each(function(a){$.cxSelect(this,t,e)}),this}});