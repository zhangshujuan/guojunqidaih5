/**
 * @author 
 * @email 
 * @descrip zhong'ou wechat.
 * @version v1.0.0
 */
define(function(require,exports,module){var o=require("zepto");+function($){"use strict";var o=function(o){var e,a=this,t=this.defaults;o=o||{};for(var n in t)"undefined"==typeof o[n]&&(o[n]=t[n]);a.params=o;var r=a.params.navbarTemplate||'<header class="bar bar-nav"><a class="icon icon-left pull-left photo-browser-close-link'+("popup"===a.params.type?" close-popup":"")+'"></a><h1 class="title"><div class="center sliding"><span class="photo-browser-current"></span> <span class="photo-browser-of">'+a.params.ofText+'</span> <span class="photo-browser-total"></span></div></h1></header>',s=a.params.toolbarTemplate||'<nav class="bar bar-tab"><a class="tab-item photo-browser-prev" href="#"><i class="icon icon-prev"></i></a><a class="tab-item photo-browser-next" href="#"><i class="icon icon-next"></i></a></nav>',i=a.params.template||'<div class="photo-browser photo-browser-'+a.params.theme+'">{{navbar}}{{toolbar}}<div data-page="photo-browser-slides" class="content">{{captions}}<div class="photo-browser-swiper-container swiper-container"><div class="photo-browser-swiper-wrapper swiper-wrapper">{{photos}}</div></div></div></div>',p=a.params.lazyLoading?a.params.photoLazyTemplate||'<div class="photo-browser-slide photo-browser-slide-lazy swiper-slide"><div class="preloader'+("dark"===a.params.theme?" preloader-white":"")+'"></div><span class="photo-browser-zoom-container"><img data-src="{{url}}" class="swiper-lazy"></span></div>':a.params.photoTemplate||'<div class="photo-browser-slide swiper-slide"><span class="photo-browser-zoom-container"><img src="{{url}}"></span></div>',l=a.params.captionsTheme||a.params.theme,d=a.params.captionsTemplate||'<div class="photo-browser-captions photo-browser-captions-'+l+'">{{captions}}</div>',c=a.params.captionTemplate||'<div class="photo-browser-caption" data-caption-index="{{captionIndex}}">{{caption}}</div>',m=a.params.objectTemplate||'<div class="photo-browser-slide photo-browser-object-slide swiper-slide">{{html}}</div>',h="",w="";for(e=0;e<a.params.photos.length;e++){var v=a.params.photos[e],u="";"string"==typeof v||v instanceof String?u=v.indexOf("<")>=0||v.indexOf(">")>=0?m.replace(/{{html}}/g,v):p.replace(/{{url}}/g,v):"object"==typeof v&&(v.hasOwnProperty("html")&&v.html.length>0?u=m.replace(/{{html}}/g,v.html):v.hasOwnProperty("url")&&v.url.length>0&&(u=p.replace(/{{url}}/g,v.url)),v.hasOwnProperty("caption")&&v.caption.length>0?w+=c.replace(/{{caption}}/g,v.caption).replace(/{{captionIndex}}/g,e):u=u.replace(/{{caption}}/g,"")),h+=u}var f=i.replace("{{navbar}}",a.params.navbar?r:"").replace("{{noNavbar}}",a.params.navbar?"":"no-navbar").replace("{{photos}}",h).replace("{{captions}}",d.replace(/{{captions}}/g,w)).replace("{{toolbar}}",a.params.toolbar?s:"");a.activeIndex=a.params.initialSlide,a.openIndex=a.activeIndex,a.opened=!1,a.open=function(o){return"undefined"==typeof o&&(o=a.activeIndex),o=parseInt(o,10),a.opened&&a.swiper?void a.swiper.slideTo(o):(a.opened=!0,a.openIndex=o,"standalone"===a.params.type&&$(a.params.container).append(f),"popup"===a.params.type&&(a.popup=$.popup('<div class="popup photo-browser-popup">'+f+"</div>"),$(a.popup).on("closed",a.onPopupClose)),"page"===a.params.type?($(document).on("pageBeforeInit",a.onPageBeforeInit),$(document).on("pageBeforeRemove",a.onPageBeforeRemove),a.params.view||(a.params.view=$.mainView),void a.params.view.loadContent(f)):(a.layout(a.openIndex),void(a.params.onOpen&&a.params.onOpen(a))))},a.close=function(){a.opened=!1,a.swiperContainer&&0!==a.swiperContainer.length&&(a.params.onClose&&a.params.onClose(a),a.attachEvents(!0),"standalone"===a.params.type&&a.container.removeClass("photo-browser-in").addClass("photo-browser-out").animationEnd(function(){a.container.remove()}),a.swiper.destroy(),a.swiper=a.swiperContainer=a.swiperWrapper=a.slides=g=b=x=void 0)},a.onPopupClose=function(){a.close(),$(a.popup).off("pageBeforeInit",a.onPopupClose)},a.onPageBeforeInit=function(o){"photo-browser-slides"===o.detail.page.name&&a.layout(a.openIndex),$(document).off("pageBeforeInit",a.onPageBeforeInit)},a.onPageBeforeRemove=function(o){"photo-browser-slides"===o.detail.page.name&&a.close(),$(document).off("pageBeforeRemove",a.onPageBeforeRemove)},a.onSliderTransitionStart=function(o){a.activeIndex=o.activeIndex;var e=o.activeIndex+1,t=o.slides.length;if(a.params.loop&&(t-=2,e-=o.loopedSlides,e<1&&(e=t+e),e>t&&(e-=t)),a.container.find(".photo-browser-current").text(e),a.container.find(".photo-browser-total").text(t),$(".photo-browser-prev, .photo-browser-next").removeClass("photo-browser-link-inactive"),o.isBeginning&&!a.params.loop&&$(".photo-browser-prev").addClass("photo-browser-link-inactive"),o.isEnd&&!a.params.loop&&$(".photo-browser-next").addClass("photo-browser-link-inactive"),a.captions.length>0){a.captionsContainer.find(".photo-browser-caption-active").removeClass("photo-browser-caption-active");var n=a.params.loop?o.slides.eq(o.activeIndex).attr("data-swiper-slide-index"):a.activeIndex;a.captionsContainer.find('[data-caption-index="'+n+'"]').addClass("photo-browser-caption-active")}var r=o.slides.eq(o.previousIndex).find("video");r.length>0&&"pause"in r[0]&&r[0].pause(),a.params.onSlideChangeStart&&a.params.onSlideChangeStart(o)},a.onSliderTransitionEnd=function(o){a.params.zoom&&g&&o.previousIndex!==o.activeIndex&&(b.transform("translate3d(0,0,0) scale(1)"),x.transform("translate3d(0,0,0)"),g=b=x=void 0,y=C=1),a.params.onSlideChangeEnd&&a.params.onSlideChangeEnd(o)},a.layout=function(o){"page"===a.params.type?a.container=$(".photo-browser-swiper-container").parents(".view"):a.container=$(".photo-browser"),"standalone"===a.params.type&&a.container.addClass("photo-browser-in"),a.swiperContainer=a.container.find(".photo-browser-swiper-container"),a.swiperWrapper=a.container.find(".photo-browser-swiper-wrapper"),a.slides=a.container.find(".photo-browser-slide"),a.captionsContainer=a.container.find(".photo-browser-captions"),a.captions=a.container.find(".photo-browser-caption");var e={nextButton:a.params.nextButton||".photo-browser-next",prevButton:a.params.prevButton||".photo-browser-prev",indexButton:a.params.indexButton,initialSlide:o,spaceBetween:a.params.spaceBetween,speed:a.params.speed,loop:a.params.loop,lazyLoading:a.params.lazyLoading,lazyLoadingInPrevNext:a.params.lazyLoadingInPrevNext,lazyLoadingOnTransitionStart:a.params.lazyLoadingOnTransitionStart,preloadImages:!a.params.lazyLoading,onTap:function(o,e){a.params.onTap&&a.params.onTap(o,e)},onClick:function(o,e){a.params.exposition&&a.toggleExposition(),a.params.onClick&&a.params.onClick(o,e)},onDoubleTap:function(o,e){a.toggleZoom($(e.target).parents(".photo-browser-slide")),a.params.onDoubleTap&&a.params.onDoubleTap(o,e)},onTransitionStart:function(o){a.onSliderTransitionStart(o)},onTransitionEnd:function(o){a.onSliderTransitionEnd(o)},onLazyImageLoad:function(o,e,t){a.params.onLazyImageLoad&&a.params.onLazyImageLoad(a,e,t)},onLazyImageReady:function(o,e,t){$(e).removeClass("photo-browser-slide-lazy"),a.params.onLazyImageReady&&a.params.onLazyImageReady(a,e,t)}};a.params.swipeToClose&&"page"!==a.params.type&&(e.onTouchStart=a.swipeCloseTouchStart,e.onTouchMoveOpposite=a.swipeCloseTouchMove,e.onTouchEnd=a.swipeCloseTouchEnd),a.swiper=$.swiper(a.swiperContainer,e),0===o&&a.onSliderTransitionStart(a.swiper),a.attachEvents()},a.attachEvents=function(o){var e=o?"off":"on";if(a.params.zoom){var t=a.params.loop?a.swiper.slides:a.slides;t[e]("gesturestart",a.onSlideGestureStart),t[e]("gesturechange",a.onSlideGestureChange),t[e]("gestureend",a.onSlideGestureEnd),t[e]("touchstart",a.onSlideTouchStart),t[e]("touchmove",a.onSlideTouchMove),t[e]("touchend",a.onSlideTouchEnd)}a.container.find(".photo-browser-close-link")[e]("click",a.close)},a.exposed=!1,a.toggleExposition=function(){a.container&&a.container.toggleClass("photo-browser-exposed"),a.params.expositionHideCaptions&&a.captionsContainer.toggleClass("photo-browser-captions-exposed"),a.exposed=!a.exposed},a.enableExposition=function(){a.container&&a.container.addClass("photo-browser-exposed"),a.params.expositionHideCaptions&&a.captionsContainer.addClass("photo-browser-captions-exposed"),a.exposed=!0},a.disableExposition=function(){a.container&&a.container.removeClass("photo-browser-exposed"),a.params.expositionHideCaptions&&a.captionsContainer.removeClass("photo-browser-captions-exposed"),a.exposed=!1};var g,b,x,y=1,C=1,T=!1;a.onSlideGestureStart=function(){return g||(g=$(this),b=g.find("img, svg, canvas"),x=b.parent(".photo-browser-zoom-container"),0!==x.length)?(b.transition(0),void(T=!0)):void(b=void 0)},a.onSlideGestureChange=function(o){b&&0!==b.length&&(y=o.scale*C,y>a.params.maxZoom&&(y=a.params.maxZoom-1+Math.pow(y-a.params.maxZoom+1,.5)),y<a.params.minZoom&&(y=a.params.minZoom+1-Math.pow(a.params.minZoom-y+1,.5)),b.transform("translate3d(0,0,0) scale("+y+")"))},a.onSlideGestureEnd=function(){b&&0!==b.length&&(y=Math.max(Math.min(y,a.params.maxZoom),a.params.minZoom),b.transition(a.params.speed).transform("translate3d(0,0,0) scale("+y+")"),C=y,T=!1,1===y&&(g=void 0))},a.toggleZoom=function(){g||(g=a.swiper.slides.eq(a.swiper.activeIndex),b=g.find("img, svg, canvas"),x=b.parent(".photo-browser-zoom-container")),b&&0!==b.length&&(x.transition(300).transform("translate3d(0,0,0)"),y&&1!==y?(y=C=1,b.transition(300).transform("translate3d(0,0,0) scale(1)"),g=void 0):(y=C=a.params.maxZoom,b.transition(300).transform("translate3d(0,0,0) scale("+y+")")))};var S,I,M,z,B,E,L,P,k,Z,D,O,R,Y,G,H,q,N={},X={};a.onSlideTouchStart=function(o){b&&0!==b.length&&(S||("android"===$.device.os&&o.preventDefault(),S=!0,N.x="touchstart"===o.type?o.targetTouches[0].pageX:o.pageX,N.y="touchstart"===o.type?o.targetTouches[0].pageY:o.pageY))},a.onSlideTouchMove=function(o){if(b&&0!==b.length&&(a.swiper.allowClick=!1,S&&g)){I||(k=b[0].offsetWidth,Z=b[0].offsetHeight,D=$.getTranslate(x[0],"x")||0,O=$.getTranslate(x[0],"y")||0,x.transition(0));var e=k*y,t=Z*y;if(!(e<a.swiper.width&&t<a.swiper.height)){if(B=Math.min(a.swiper.width/2-e/2,0),L=-B,E=Math.min(a.swiper.height/2-t/2,0),P=-E,X.x="touchmove"===o.type?o.targetTouches[0].pageX:o.pageX,X.y="touchmove"===o.type?o.targetTouches[0].pageY:o.pageY,!I&&!T&&(Math.floor(B)===Math.floor(D)&&X.x<N.x||Math.floor(L)===Math.floor(D)&&X.x>N.x))return void(S=!1);o.preventDefault(),o.stopPropagation(),I=!0,M=X.x-N.x+D,z=X.y-N.y+O,M<B&&(M=B+1-Math.pow(B-M+1,.8)),M>L&&(M=L-1+Math.pow(M-L+1,.8)),z<E&&(z=E+1-Math.pow(E-z+1,.8)),z>P&&(z=P-1+Math.pow(z-P+1,.8)),R||(R=X.x),H||(H=X.y),Y||(Y=Date.now()),G=(X.x-R)/(Date.now()-Y)/2,q=(X.y-H)/(Date.now()-Y)/2,Math.abs(X.x-R)<2&&(G=0),Math.abs(X.y-H)<2&&(q=0),R=X.x,H=X.y,Y=Date.now(),x.transform("translate3d("+M+"px, "+z+"px,0)")}}},a.onSlideTouchEnd=function(){if(b&&0!==b.length){if(!S||!I)return S=!1,void(I=!1);S=!1,I=!1;var o=300,e=300,t=G*o,n=M+t,r=q*e,s=z+r;0!==G&&(o=Math.abs((n-M)/G)),0!==q&&(e=Math.abs((s-z)/q));var i=Math.max(o,e);M=n,z=s;var p=k*y,l=Z*y;B=Math.min(a.swiper.width/2-p/2,0),L=-B,E=Math.min(a.swiper.height/2-l/2,0),P=-E,M=Math.max(Math.min(M,L),B),z=Math.max(Math.min(z,P),E),x.transition(i).transform("translate3d("+M+"px, "+z+"px,0)")}};var j,W,V,A,F,J=!1,K=!0,Q=!1;return a.swipeCloseTouchStart=function(){K&&(J=!0)},a.swipeCloseTouchMove=function(o,e){if(J){Q||(Q=!0,W="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,A=a.swiper.slides.eq(a.swiper.activeIndex),F=(new Date).getTime()),e.preventDefault(),V="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,j=W-V;var t=1-Math.abs(j)/300;A.transform("translate3d(0,"+-j+"px,0)"),a.swiper.container.css("opacity",t).transition(0)}},a.swipeCloseTouchEnd=function(){if(J=!1,!Q)return void(Q=!1);Q=!1,K=!1;var o=Math.abs(j),e=(new Date).getTime()-F;return e<300&&o>20||e>=300&&o>100?void setTimeout(function(){"standalone"===a.params.type&&a.close(),"popup"===a.params.type&&$.closeModal(a.popup),a.params.onSwipeToClose&&a.params.onSwipeToClose(a),K=!0},0):(0!==o?A.addClass("transitioning").transitionEnd(function(){K=!0,A.removeClass("transitioning")}):K=!0,a.swiper.container.css("opacity","").transition(""),void A.transform(""))},a};o.prototype={defaults:{photos:[],container:"body",initialSlide:0,spaceBetween:20,speed:300,zoom:!0,maxZoom:3,minZoom:1,exposition:!0,expositionHideCaptions:!1,type:"standalone",navbar:!0,toolbar:!0,theme:"light",swipeToClose:!0,backLinkText:"Close",ofText:"of",loop:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingOnTransitionStart:!1}},$.photoBrowser=function(e){return $.extend(e,$.photoBrowser.prototype.defaults),new o(e)},$.photoBrowser.prototype={defaults:{}}}(o)});